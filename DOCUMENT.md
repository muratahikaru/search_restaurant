# 簡易仕様書

## アプリ名
お手軽レストラン検索

## 対象OSおよびブラウザ
### 対象OS
macOS Big Sur 11.6.4
### ブラウザ
Safari 15.3

## 開発環境/言語
### 開発環境
- RubyMine
- docker

###　言語
ruby 3.0.1

## 開発期間
二週間

## 機能要件
- 現在地取得
- 現在地からレストランを検索
- 結果の一覧表示
- 一覧のページネーション
- レストランの詳細ページ
- レストランをGoogle Mapで表示

## フレームワーク
Ruby on Rails 6.1.4

## 設計ドキュメント
### 概要
- 現在地取得
- 現在地からレストランを検索・取得
- 結果のページネーション
- レストラン詳細取得
- レストランをGoogle Mapで表示

### ワークフロー
#### 検索・一覧
1. ルートURLで検索画面へ遷移
2. Geolocation APIで経度・緯度を取得(restaurant/search.js)
3. 「検索ボタン」クリックで経度・緯度、範囲をクエリパラメータに持たせrestaurantsコントローラーのindexアクションを実行
4. レストランのデータがすでにキャッシュとして存在すれば、そのキャッシュを利用してkaminari gemでページネーションに対応したデータをインスタンス変数に保存
5. キャッシュが存在しなければ、ホットペッパー グルメサーチ APIでデータを取得、キャッシュに保存する
6. データが空であれば、「見つかりませんでした」ページに遷移 
7. データが存在すれば取得したデータをインスタンス変数に保存

#### 詳細
1. 一覧ページのレストランデータそれぞれにidをクエリパラメータに持たせたリンクを付与
2. restaurantsコントローラーのshowアクションを実行
3. idをもとにホットペッパー グルメサーチ APIでレストランを特定し取得
4. データをインスタンス変数に格納
5. htmlのカスタムデータ属性にレストランの経度・緯度のデータを保持させる
6. restaurant/map.jsでカスタムデータ属性から経度・緯度を取得し、Google Map APIでレストランの位置マーキング

## コンセプト
近くにお店を簡単に探せる

## こだわったポイント
- ホットペッパーグルメサーチAPIを使用して一覧を表示する際に、レスポンス速度を上げるために取得データをキャッシュに保存した。結果、2ページ目以降のレスポンス速度は、最初のレスポンス速度と比較して10分の1程度まで速度が上昇した。
- レストランの位置をGoogle Mapを利用してマーキングすることで、視覚的にわかりやすくした。

## デザイン面でこだわったポイント
- 店名などの大切な情報は文字を大きく、太くし見やすくした
- 一覧ページのボトムに、検索画面への導線を用意し、検索画面に戻りたい時にトップのぱんくずリストまでスクロールしなくて良いようにした

## アドバイスして欲しいポイント
- よりパフォーマンスを上げるにはどうしたらいいか
- 他にどういう導線があると便利であるか
- 今より良いデザインにするにはどういう工夫が必要か

## 自己評価
- 要件について満たすことができた思うが、デザイン面の知識が足りず簡素なデザインになってしまった。
- 検索の最初のレスポンス以降の速度は、キャッシュによってとても上昇したのでそこはよかったが、最初のレスポンスは取得データ量が多い時、非常に遅くなることが時折生じた。
- 一覧ページから検索画面へブラウザバックすることによってキャッシュがクリアされず、その後再度検索すると取得データが異なってしまうバグを修正することができなかった。
- レストラン詳細ページのGoogle Mapが表示されないことが時折発生し、それを修正することができなかった。